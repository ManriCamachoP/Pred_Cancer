---
title: "Prediction of Breast Cancer Notebook"
author: 
  name: "Manrique Camacho P., Amanda Cedeño G., Iván Rodríguez C."

institute: "Universidad de Costa Rica"
lang: es  
date: today
date-format: long
format: 
  html:
    toc: true
    toc-depth: 4
    theme: united
    df-print: kable
    number-sections: true
    highlight-style: github
    fig-dpi: 600
    fig-width: 10
    fig-height: 6
    fig-align: default
    fig-format: png
editor: visual
execute: 
  echo: true
  warning: false
  message: false
---

# Breast Cancer Descriptive Analysis

## Loading Libraries

```{r}
#Data Manipulation and Visualization

library(tidyverse) #Ecosystem which contains our main libraries as dplyr and ggplot2
library(caret) #Data partitioning and model evaluation
```

## Importing the dataset

```{r}
data <- read.csv("~/Library/CloudStorage/OneDrive-UniversidaddeCostaRica/GitHub/Predicción_Cancer/data/processed/data.csv", row.names=1)
```

## Data Inspection

```{r}
str(data)
```

```{r}
na_data = matrix(rep(NA, length(colnames(data[,-1]))
                     ), nrow = 1
                 )


for (i in 2:ncol(data)){
 
  na_data[1,i-1] = sum(is.na(data[,i]))
   
}

na_data = as.data.frame(x = na_data)
colnames(na_data) = colnames(data[,-1])
row.names(na_data) = "Cantidad NA"
as.data.frame(t(na_data))$`Cantidad NA` - nrow(data)


na_data[2,] = abs(as.data.frame(t(na_data))$`Cantidad NA` - nrow(data))

row.names(na_data) = c("Cantidad NA", "Cantidad de Valores Completos")
na_data = as.data.frame(t(na_data)); na_data

na_data$Variable <- rownames(na_data)
na_data_long <- pivot_longer(na_data, cols = c("Cantidad NA", "Cantidad de Valores Completos"), names_to = "Status", values_to = "Count")

na_data_long <- na_data_long %>%
  group_by(Variable) %>%
  mutate(Total_NA = sum(Count[Status == "Cantidad NA"])) %>%
  ungroup() %>%
  arrange(Total_NA) %>%
  mutate(Variable = factor(Variable, levels = unique(Variable)))


na_data_long <- na_data_long %>%
  group_by(Variable) %>%
  mutate(Percentage = ifelse(Status == "Cantidad NA" & Count > 0.9, paste0(round((Count / sum(Count)) * 100, 1), "%"), ""))


# Crear el gráfico de barras apiladas con códigos de color HTML
ggplot(na_data_long, aes(x = Variable, y = Count, fill = Status)) +
  geom_bar(stat = "identity", position = "stack") +
  geom_text(aes(label = Percentage), position = position_stack(vjust = 0.5), color = "white", size = 3) +
  labs(title = "Conteo de Valores NA y No-NA por Variable",
       x = "Variable",
       y = "Conteo") +
  scale_fill_manual(values = c("Cantidad NA" = "#FF6347", "Cantidad de Valores Completos" = "#1E90FF"))+
  coord_flip()+
  theme_minimal()+ 
  theme(axis.text.x = element_text(angle = 90, hjust = 1.2),
        legend.position = "top",
      legend.title = element_blank(),
      legend.key.size = unit(0.5, "cm"))


data2 = drop_na(data)

sum(data2$BreastCancer=="Breast Cancer")/nrow(data2)
```
